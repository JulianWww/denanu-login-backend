<?php
  include "./dependancies/headers.php";

  function signup($data, $fileRoot) {
    $name = clean($_REQUEST["username"]);
    $userfile = $fileRoot . '/' . $name . '.json';
    
    if (file_exists($userfile)) {
      print("{\"status\": \"fail\", \"reason\": \"uname Exists\"}");
      die();
    }

    $json = array();
    $json["password"] = hash("sha512", $_REQUEST["password"]);
    $json["email"] = $_REQUEST["email"];
    $json["sendmail"] = $_REQUEST["sendmail"];

    $token = genToken();
    $json["token"] = $token;

    file_put_contents($userfile, json_encode($json, JSON_PRETTY_PRINT));

    print("{\"status\": \"success\", \"data\": {\"token\": \"" . $token . "\", \"username\": \"" . $_REQUEST["username"] . "\"}}");
  };

  signup($_REQUEST, "./data");
?>